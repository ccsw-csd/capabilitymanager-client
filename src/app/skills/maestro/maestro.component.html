<p-progressSpinner
  *ngIf="!load"
  class="flex justify-content-center mt-5"
></p-progressSpinner>

<div *ngIf="load">
  <div class="flex justify-content-between">
    <h3 class="text-primary">
      {{ selectedReportName }}
      <span
        ><p-chip *ngIf="titleScreenshotChip == 1" label="Screenshot"></p-chip
      ></span>
    </h3>

    <div class="my-2 flex justify-content-end">
      <!-- BOTON DE EXPORTAR SI TIENE PERMISOS "EXPORTAR" -->
      <button
        *ngIf="authService.hasRole('EXPORTAR')"
        type="button"
        pButton
        pRipple
        icon="pi pi-file-excel"
        class="p-button-outlined my-2"
        (click)="menu.toggle($event)"
        style="width: 80px"
      >
        <i class="pi pi-angle-down m-2"></i>
      </button>
      <p-menu #menu [popup]="true" [model]="items"></p-menu>
    </div>
  </div>
  <div
    class="flex justify-content-between"
    style="margin-top: 0%; padding-top: 0%"
  >
    <h4
      *ngIf="titleScreenshotChip == 1"
      style="
        color: #ffffff;
        background-color: #29abe2;
        padding: 12px;
        border-radius: 12px;
        margin-top: 0px;
      "
    >
      Marcado como ScreenShot el
      {{ selectedReportNameModificationDate | date : "d/M/yy" }} por
      {{ selectedReportNameUserName }}
    </h4>
  </div>

  <p-accordion [activeIndex]="-1">
    <p-accordionTab>
      <ng-template pTemplate="header">
        <span class="flex align-items-center gap-2 w-full;">
          <span class="font-bold white-space-nowrap text-primary">Filtros</span>
        </span>
      </ng-template>
      <div class="flex flex-wrap justify-content-center gap-3">
        <div class="flex align-items-center justify-content-center">
          <!-- SELECCIONAR SI ES SCREENSHOT -->
          <p-dropdown
            [options]="screenshotsOptions"
            class="m-2"
            [style]="{ width: '210px' }"
            [(ngModel)]="selectedScreenshot"
            optionLabel="name"
            [showClear]="false"
            placeholder="Versión Screenshot"
            (onChange)="onScreenshotChange()"
          >
          </p-dropdown>
        </div>
        <div class="flex align-items-center justify-content-center">
          <!-- SELECCIONAR AÑO -->
          <p-dropdown
            [options]="reportYears"
            class="m-2"
            [style]="{ width: '210px' }"
            [(ngModel)]="selectedReportYear"
            [showClear]="false"
            placeholder="Seleccione un Año"
            (onChange)="onYearChange()"
            [disabled]="disableYearDrop"
          >
          </p-dropdown>
        </div>
        <div class="flex align-items-center justify-content-center">
          <!-- SELECCIONAR VERSION -->
          <p-dropdown
            [options]="reportVersions"
            class="m-2"
            [style]="{ width: '340px' }"
            [(ngModel)]="selectedReportVersion"
            optionLabel="descripcion"
            [showClear]="false"
            placeholder="Seleccione una versión"
            (onChange)="onVersionChange()"
            [disabled]="disableVersionDrop"
          >
          </p-dropdown>
        </div>
        <div class="flex align-items-center justify-content-center">
          <button
            pButton
            type="button"
            pRipple
            icon="pi pi-search"
            class="p-button-outlined m-2"
            (click)="reloadComponent()"
            style="width: 80px"
            [disabled]="disableButtonSearch"
          ></button>
        </div>
      </div>
    </p-accordionTab>
  </p-accordion>

  <p-accordion [activeIndex]="-1">
    <p-accordionTab header="Filtros">
      <div class="flex flex-wrap justify-content-center gap-3">
        <div class="flex align-items-center justify-content-center">
          <!-- SELECCIONAR SI ES SCREENSHOT -->
          <p-dropdown
            [options]="screenshotsOptions"
            class="m-2"
            [style]="{ width: '210px' }"
            [(ngModel)]="selectedScreenshot"
            optionLabel="name"
            [showClear]="false"
            placeholder="Versión Screenshot"
            (onChange)="onScreenshotChange()"
          >
          </p-dropdown>
        </div>
        <div class="flex align-items-center justify-content-center">
          <!-- SELECCIONAR AÑO -->
          <p-dropdown
            [options]="reportYears"
            class="m-2"
            [style]="{ width: '210px' }"
            [(ngModel)]="selectedReportYear"
            [showClear]="false"
            placeholder="Seleccione un Año"
            (onChange)="onYearChange()"
            [disable]="enableReportYearSelection"
          >
          </p-dropdown>
        </div>
        <div class="flex align-items-center justify-content-center">
          <!-- SELECCIONAR VERSION -->
          <p-dropdown
            [options]="reportVersions"
            class="m-2"
            [style]="{ width: '340px' }"
            [(ngModel)]="selectedReportVersion"
            optionLabel="descripcion"
            [showClear]="false"
            placeholder="Seleccione una versión"
            (onChange)="onVersionChange()"
            [disable]="enableReportVersionSelection"
          >
          </p-dropdown>
        </div>
        <div class="flex align-items-center justify-content-center">
          <button
            pButton
            type="button"
            pRipple
            icon="pi pi-search"
            class="p-button-outlined m-2"
            (click)="reloadComponent()"
            style="width: 80px"
          ></button>
        </div>
      </div>
    </p-accordionTab>
  </p-accordion>

  <div class="flex flex-column lg:flex-row">
    <div class="card my-3" style="margin-right: 2%">
      <app-table-detail
        [data]="EMData"
        [columnas]="EMCol"
        [text]="EMText"
      ></app-table-detail>
    </div>
    <div class="card my-3">
      <app-table-detail
        [data]="BAData"
        [columnas]="BACol"
        [text]="BAText"
      ></app-table-detail>
    </div>
  </div>

  <div class="flex flex-column lg:flex-row">
    <div class="card my-3" style="margin-right: 2%">
      <app-table-detail
        [data]="ARData"
        [columnas]="ARCol"
        [text]="ARText"
      ></app-table-detail>
    </div>
    <div class="card my-3">
      <app-table-detail
        [data]="SEData"
        [columnas]="SECol"
        [text]="SEText"
      ></app-table-detail>
    </div>
  </div>

  <div class="py-3">
    <app-table-detail
      [data]="IEData"
      [columnas]="IECol"
      [text]="IEText"
    ></app-table-detail>
  </div>

  <!-- Specific Zoom -->
  <h3 class="card my-3">SPECIFIC ZOOM</h3>
  <div class="card py-3">
    <app-table-detail
      [data]="ArSeDevData"
      [columnas]="ArSeDevCol"
      [text]="ArSeDevText"
      [extraHeader]="true"
    ></app-table-detail>
  </div>

  <div class="my-2">
    <app-table-detail
      [data]="ArSeApiData"
      [columnas]="ArSeApiCol"
      [text]="ArSeApiText"
    ></app-table-detail>
  </div>

  <!-- Pyramide -->
  <h3 class="card mt-4">PYRAMID</h3>
  <div class="card py-2">
    <app-table-detail
      [data]="gradesRoles"
      [columnas]="rolesCol"
      [text]="gradeRoleText"
    ></app-table-detail>
  </div>

  <p-divider></p-divider>

  <div class="flex items-centerml-2 mt-4">
    <div class="small-input-switch">
      <p-inputSwitch
        [(ngModel)]="screenshotEnabled"
        (onChange)="toggleScreenshot()"
        label="Screenshot"
        class="small-input-switch mt-3"
      ></p-inputSwitch>
    </div>
    <span style="margin-left: 0.5rem">Screenshot</span>
    <div class="ml-3">
      <span
        *ngIf="hasScreenshotChanged"
        style="
          color: #ffffff;
          background-color: #29abe2;
          padding: 12px;
          border-radius: 12px;
        "
      >
        El informe ha cambiado. Pulse guardar
      </span>
    </div>
      ></p-inputSwitch>
    </div>
    <span style="margin-left: 0.5rem">Screenshot</span>
    <span *ngIf="hasScreenshotChanged" class="ml-3"
      >El informe ha cambiado. Pulse guardar</span
    >
  </div>

  <!-- Comentarios-->
  <div class="py-4 mt-2 flex">
    <span class="p-float-label">
      <textarea
        class="p-6"
        id="float-input"
        rows="10"
        cols="140"
        pInputTextarea
        [(ngModel)]="comentarios"
      ></textarea>
      <label for="float-input">Comentarios</label>
    </span>
  </div>

  <!-- Botón guardar-->
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>
  <div class="flex align-items-center justify-content-between">
    <button
      pButton
      type="button"
      (click)="confirmUpdateReport($event)"
      pRipple
      icon="pi pi-save"
      label="Guardar"
      class="p-button p-button-primary p-button-outlined my-2"
      tyle="width: 80px"
      label="Guardar"
      pRipple
      icon="pi pi-save"
      class="p-button p-button-primary p-button-outlined my-2"
      (click)="updateReport()"
      style="width: 80px"
    ></button>
  </div>

  <!-- Dialog exports -->
  <p-dialog
    header="Selecciona tu lista:"
    [(visible)]="visible"
    [style]="{ width: '50vw' }"
    [closable]="false"
  >
    <div class="flex flex-column ml-5">
      <div *ngFor="let elem of tableList" class="field-checkbox">
        <p-radioButton
          [inputId]="elem"
          name="category"
          [value]="elem"
          [(ngModel)]="selectedExcel"
        ></p-radioButton>
        <label [for]="elem" class="ml-2">{{ elem }}</label>
      </div>
    </div>
    <div class="flex flex-row mt-5 gap-2 justify-content-end gap-2">
      <button
        pButton
        pRipple
        styleClass=""
        label="Cancelar"
        class="p-button p-button-secondary p-button-outlined"
        (click)="closeDialog()"
      ></button>
      <button
        pButton
        pRipple
        p-button-label="10px"
        label="Exportar"
        [disabled]="selectedExcel == ''"
        (click)="exportExcel()"
      ></button>
    </div>
  </p-dialog>
</div>
